From bc086454d68524b978050bdbda464136e74c80d2 Mon Sep 17 00:00:00 2001
Message-Id: <cover-00.30-00000000000-20210614T101813Z-avarab@gmail.com>
In-Reply-To: <cover-00.31-00000000000-20210528T110515Z-avarab@gmail.com>
References: <cover-00.31-00000000000-20210528T110515Z-avarab@gmail.com>
From: Ævar Arnfjörð Bjarmason <avarab@gmail.com>
Date: Mon, 14 Jun 2021 12:18:13 +0200
Subject: [PATCH 00/30] *** SUBJECT HERE ***
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

*** BLURB HERE ***

Emily Shaffer (26):
  hook: add 'run' subcommand
  hook.c: add a hook_exists() wrapper and use it in bugreport.c
  gc: use hook library for pre-auto-gc hook
  rebase: teach pre-rebase to use hook.h
  am: convert applypatch hooks to use config
  hooks: convert 'post-checkout' hook to hook library
  merge: use config-based hooks for post-merge hook
  send-email: use 'git hook run' for 'sendemail-validate'
  git-p4: use 'git hook' to run hooks
  commit: use hook.h to execute hooks
  read-cache: convert post-index-change hook to use config
  receive-pack: convert push-to-checkout hook to hook.h
  run-command: remove old run_hook_{le,ve}() hook API
  run-command: allow stdin for run_processes_parallel
  hook: support passing stdin to hooks
  am: convert 'post-rewrite' hook to hook.h
  run-command: add stdin callback for parallelization
  hook: provide stdin by string_list or callback
  hook: convert 'post-rewrite' hook in sequencer.c to hook.h
  transport: convert pre-push hook to use config
  reference-transaction: use hook.h to run hooks
  run-command: allow capturing of collated output
  hooks: allow callers to capture output
  receive-pack: convert 'update' hook to hook.h
  post-update: use hook.h library
  receive-pack: convert receive hooks to hook.h

Ævar Arnfjörð Bjarmason (4):
  run-command.h: move find_hook() to hook.h
  git hook run: add an --ignore-missing flag
  hooks: fix a TOCTOU in "did we run a hook?" heuristic
  hook-list.h: add a generated list of hooks, like config-list.h

 .gitignore                  |   2 +
 Documentation/git-hook.txt  |  49 ++++++
 Documentation/githooks.txt  |   4 +
 Makefile                    |  16 +-
 builtin.h                   |   1 +
 builtin/am.c                |  34 ++--
 builtin/bugreport.c         |  46 ++----
 builtin/checkout.c          |  17 +-
 builtin/clone.c             |   7 +-
 builtin/commit.c            |  19 ++-
 builtin/fetch.c             |   1 +
 builtin/gc.c                |   8 +-
 builtin/hook.c              |  72 +++++++++
 builtin/merge.c             |  22 ++-
 builtin/rebase.c            |   9 +-
 builtin/receive-pack.c      | 299 ++++++++++++++++++------------------
 builtin/submodule--helper.c |   2 +-
 builtin/worktree.c          |  31 ++--
 command-list.txt            |   1 +
 commit.c                    |  17 +-
 commit.h                    |   3 +-
 generate-hooklist.sh        |  24 +++
 git-p4.py                   |  72 +--------
 git-send-email.perl         |  20 ++-
 git.c                       |   1 +
 hook.c                      | 224 +++++++++++++++++++++++++++
 hook.h                      | 122 +++++++++++++++
 read-cache.c                |  12 +-
 refs.c                      |  43 ++----
 reset.c                     |  15 +-
 run-command.c               | 157 ++++++++++---------
 run-command.h               |  55 ++++---
 sequencer.c                 |  88 +++++------
 submodule.c                 |   1 +
 t/helper/test-run-command.c |  46 +++++-
 t/t0061-run-command.sh      |  37 +++++
 t/t1800-hook.sh             | 162 +++++++++++++++++++
 t/t9001-send-email.sh       |   4 +-
 transport.c                 |  58 ++-----
 39 files changed, 1246 insertions(+), 555 deletions(-)
 create mode 100644 Documentation/git-hook.txt
 create mode 100644 builtin/hook.c
 create mode 100755 generate-hooklist.sh
 create mode 100644 hook.c
 create mode 100644 hook.h
 create mode 100755 t/t1800-hook.sh

Range-diff:
 1:  447d349c738 =  1:  447d349c738 hook: add 'run' subcommand
 2:  85195a78cfb =  2:  85195a78cfb run-command.h: move find_hook() to hook.h
 3:  eb5bdd993c8 =  3:  eb5bdd993c8 hook.c: add a hook_exists() wrapper and use it in bugreport.c
 4:  da2763192ae =  4:  da2763192ae gc: use hook library for pre-auto-gc hook
 5:  51e6e72f239 =  5:  51e6e72f239 rebase: teach pre-rebase to use hook.h
 6:  d2f3b26d464 =  6:  d2f3b26d464 am: convert applypatch hooks to use config
 7:  d884465aab3 =  7:  d884465aab3 hooks: convert 'post-checkout' hook to hook library
 8:  ad6e7507841 =  8:  ad6e7507841 merge: use config-based hooks for post-merge hook
 9:  8d8b2d26453 =  9:  8d8b2d26453 git hook run: add an --ignore-missing flag
10:  1953326d1db = 10:  1953326d1db send-email: use 'git hook run' for 'sendemail-validate'
11:  aa970a81752 = 11:  aa970a81752 git-p4: use 'git hook' to run hooks
12:  7756f10aac9 = 12:  7756f10aac9 commit: use hook.h to execute hooks
13:  0300607a9b4 = 13:  0300607a9b4 read-cache: convert post-index-change hook to use config
14:  ec4ad437f86 = 14:  ec4ad437f86 receive-pack: convert push-to-checkout hook to hook.h
15:  477eb2245c3 = 15:  477eb2245c3 run-command: remove old run_hook_{le,ve}() hook API
16:  53a3877a476 = 16:  53a3877a476 run-command: allow stdin for run_processes_parallel
17:  c4f60db606d = 17:  c4f60db606d hook: support passing stdin to hooks
18:  febf05ef232 = 18:  febf05ef232 am: convert 'post-rewrite' hook to hook.h
19:  7baf2469d50 = 19:  7baf2469d50 run-command: add stdin callback for parallelization
20:  2edf9dea41a = 20:  2edf9dea41a hook: provide stdin by string_list or callback
21:  303b31ee620 = 21:  303b31ee620 hook: convert 'post-rewrite' hook in sequencer.c to hook.h
22:  62eecafb3ff = 22:  62eecafb3ff transport: convert pre-push hook to use config
23:  6049b1cdc74 = 23:  6049b1cdc74 reference-transaction: use hook.h to run hooks
24:  26ebbe4c545 = 24:  26ebbe4c545 run-command: allow capturing of collated output
25:  251085b7525 = 25:  251085b7525 hooks: allow callers to capture output
26:  e11a8f60071 = 26:  e11a8f60071 receive-pack: convert 'update' hook to hook.h
27:  ecaedd13b89 = 27:  ecaedd13b89 post-update: use hook.h library
28:  bb9d57f809a = 28:  bb9d57f809a receive-pack: convert receive hooks to hook.h
29:  793f112f7ab = 29:  793f112f7ab hooks: fix a TOCTOU in "did we run a hook?" heuristic
30:  bc086454d68 = 30:  bc086454d68 hook-list.h: add a generated list of hooks, like config-list.h
-- 
2.32.0.rc3.434.gd8aed1f08a7

