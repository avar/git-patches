From 470010bbb519a49cc463e79e2195e4e332aba25d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C3=86var=20Arnfj=C3=B6r=C3=B0=20Bjarmason?=
 <avarab@gmail.com>
Date: Sun, 7 Mar 2021 01:38:52 +0100
Subject: [PATCH 08/16] wip test

---
 t/t6102-rev-list-unexpected-objects.sh | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/t/t6102-rev-list-unexpected-objects.sh b/t/t6102-rev-list-unexpected-objects.sh
index 6c2d947d322..9a5e84ff024 100755
--- a/t/t6102-rev-list-unexpected-objects.sh
+++ b/t/t6102-rev-list-unexpected-objects.sh
@@ -31,7 +31,8 @@ test_expect_success 'setup unexpected non-tree entry' '
 '
 
 test_expect_success 'traverse unexpected non-tree entry (lone)' '
-	test_must_fail git rev-list --objects $broken_tree
+	test_must_fail git rev-list --objects $broken_tree >output 2>&1 &&
+	test_i18ngrep "not a tree" output
 '
 
 test_expect_success 'traverse unexpected non-tree entry (seen)' '
@@ -152,6 +153,16 @@ test_expect_success 'setup unexpected non-tag tag' '
 	commit_tag_blob=$(git hash-object -w -t tag broken-commit-tag-blob)
 '
 
+test_expect_success 'traverse unexpected incorrectly typed tag (to tree)' '
+	test_must_fail git rev-list --objects $tag_tag_tree 2>actual &&
+	echo "fatal: object $tree is a tree, not a tag" >expected &&
+	test_cmp expected actual &&
+
+	test_must_fail git rev-list --objects $commit_tag_tree 2>actual &&
+	echo "fatal: object $tree is a tree, not a commit" >expected &&
+	test_cmp expected actual
+'
+
 test_expect_success 'traverse unexpected incorrectly typed tag (to blob)' '
 	test_must_fail git rev-list --objects $tag_tag_blob 2>actual &&
 	echo "fatal: object $blob is a blob, not a tag" >expected &&
-- 
2.31.0.rc0.126.g04f22c5b82

