From 6889947120669d4ff91d4a8461bd01fc176e6261 Mon Sep 17 00:00:00 2001
Message-Id: <cover-v3-0.1-00000000000-20210830T143940Z-avarab@gmail.com>
In-Reply-To: <patch-v2-1.1-9e846b76959-20210823T125434Z-avarab@gmail.com>
References: <patch-v2-1.1-9e846b76959-20210823T125434Z-avarab@gmail.com>
From: Ævar Arnfjörð Bjarmason <avarab@gmail.com>
Date: Mon, 30 Aug 2021 16:39:40 +0200
Subject: [PATCH v3 0/1] *** SUBJECT HERE ***
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

*** BLURB HERE ***

Ævar Arnfjörð Bjarmason (1):
  pull, fetch: fix segfault in --set-upstream option

 builtin/fetch.c         | 10 ++++++++++
 t/t5553-set-upstream.sh | 22 ++++++++++++++++++++++
 2 files changed, 32 insertions(+)

Range-diff against v2:
1:  9e846b76959 ! 1:  68899471206 pull, fetch: fix segfault in --set-upstream option
    @@ builtin/fetch.c: static int do_fetch(struct transport *transport,
      		}
      		if (source_ref) {
     +			if (!branch) {
    -+				const char *shortname = NULL;
    -+				if (!skip_prefix(source_ref->name,
    -+						 "refs/heads/", &shortname))
    -+					shortname = source_ref->name;
    ++				const char *shortname = source_ref->name;
    ++				skip_prefix(shortname, "refs/heads/", &shortname);
    ++
     +				warning(_("could not set upstream of HEAD to '%s' from '%s' when "
     +					  "it does not point to any branch."),
     +					shortname, transport->remote->name);
-- 
2.33.0.741.g4db85f1eb27

