From e4ca8b26962bc8b46a76284dbcfe1ad6beec34b2 Mon Sep 17 00:00:00 2001
Message-Id: <cover-v2-0.4-00000000000-20210823T110102Z-avarab@gmail.com>
In-Reply-To: <cover-0.4-0000000000-20210727T004015Z-avarab@gmail.com>
References: <cover-0.4-0000000000-20210727T004015Z-avarab@gmail.com>
From: Ævar Arnfjörð Bjarmason <avarab@gmail.com>
Date: Mon, 23 Aug 2021 13:01:02 +0200
Subject: [PATCH v2 0/4] *** SUBJECT HERE ***
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

*** BLURB HERE ***

Ævar Arnfjörð Bjarmason (4):
  bundle API: start writing API documentation
  bundle API: change "flags" to be "extra_index_pack_args"
  index-pack: add --progress-title option
  bundle: show progress on "unbundle"

 Documentation/git-index-pack.txt |  6 ++++++
 builtin/bundle.c                 | 16 ++++++++++++++--
 builtin/index-pack.c             |  6 ++++++
 bundle.c                         | 17 +++++++++++------
 bundle.h                         | 15 +++++++++++++--
 transport.c                      |  5 ++++-
 6 files changed, 54 insertions(+), 11 deletions(-)

Range-diff against v1:
 1:  4af3dd419bc <  -:  ----------- upload-pack: run is_repository_shallow() before setup_revisions()
 2:  7ffbf7d1e11 <  -:  ----------- revision.h: refactor "disable_stdin" and "read_from_stdin"
 3:  e6df6c8f4bb <  -:  ----------- revision.[ch]: add a "handle_stdin_line" API
 4:  df690934864 <  -:  ----------- pack-objects.c: do stdin parsing via revision.c's API
 5:  1b84319afee <  -:  ----------- pack-objects.c: make use of REV_INFO_STDIN_LINE_PROCESS
 6:  b8f8a20e789 <  -:  ----------- bundle doc: rewrite the "DESCRIPTION" section
 7:  5f344bd24aa <  -:  ----------- bundle doc: elaborate on object prerequisites
 8:  0e702337c7f <  -:  ----------- bundle doc: elaborate on rev<->ref restriction
 9:  1f3dcd42863 <  -:  ----------- bundle doc: replace "basis" with "prerequsite(s)"
10:  4bebe705436 <  -:  ----------- revision.h: add an "again" return value to "handle_stdin_line"
11:  b07199195fa <  -:  ----------- bundle: allow specifying ref names in --stdin input
12:  f0fdb19d4e5 <  -:  ----------- bundle tests: use ">file" not ": >file"
13:  a4a92d7c441 <  -:  ----------- bundle tests: use test_cmp instead of grep
14:  b5361fa9a46 <  -:  ----------- serve: mark has_capability() as static
15:  92c2854a9e2 <  -:  ----------- transport: rename "fetch" in transport_vtable to "fetch_refs"
16:  64c2313c020 <  -:  ----------- transport: use designated initializers
17:  0a685cad0b1 <  -:  ----------- serve: use designated initializers
18:  b00e7c02aee <  -:  ----------- serve.c: add call_{advertise,command}() indirection
19:  271b4650d27 <  -:  ----------- serve: add support for a "startup" git_config() callback
20:  7ac9f4ada34 <  -:  ----------- serve.c: move version line to advertise_capabilities()
21:  115d8dfc247 <  -:  ----------- serve.[ch]: remove "serve_options", split up --advertise-refs code
22:  3d924645da0 <  -:  ----------- {upload,receive}-pack tests: add --advertise-refs tests
23:  68d2a729199 <  -:  ----------- upload-pack: document and rename --advertise-refs
24:  e0ca1499e7f <  -:  ----------- upload-pack.c: convert to new serve.c "startup" config cb
25:  2b128887415 <  -:  ----------- serve.[ch]: don't pass "struct strvec *keys" to commands
26:  8cc9b1c0f10 <  -:  ----------- serve tests: add missing "extra delim" test
27:  2927b143072 <  -:  ----------- serve tests: use test_cmp in "protocol violations" test
28:  c1716cecc15 <  -:  ----------- upload-pack tests: use test-tool pkt-line & test_cmp in test
29:  1983de3e9d4 <  -:  ----------- serve tests: add basic uploadpack.blobPackFileURI test
30:  a34a85df53e <  -:  ----------- upload-pack tests: test exact stdout/stderr on error
31:  018e333f879 <  -:  ----------- serve tests: move & improve "unexpected line" test
32:  2357174ee9c <  -:  ----------- protocol v2: test "fetch" error handling
33:  7c6b24ac352 <  -:  ----------- protocol v2: test "ls-refs" error handling
34:  a316226c374 <  -:  ----------- protocol v2 tests: test exact stdout/stderr for .gitmodules fsck
35:  4ce357a79f7 <  -:  ----------- protocol v2 tests: test exact stdout/stderr on error
36:  5f0b6c6eba7 <  -:  ----------- fetch tests: fix cleanup logic in --negotiate-only tests
37:  27b3543c6ed <  -:  ----------- protocol v2 tests: fix cleanup logic in main v2 tests
38:  d7a60daa678 <  -:  ----------- protocol v2 tests: split up and rename t5702-protocol-v2.sh
39:  8dd33f7922c <  -:  ----------- protocol v2 tests: stress (often strange) packfile-uri behavior
40:  e1407f2bff1 <  -:  ----------- fsck.c: clarify fsck_gitmodules_fn() by using "else if"
41:  e7a08201cad <  -:  ----------- fsck: fix over-reporting of FSCK_MSG_GITMODULES_NAME
42:  ea413ba6491 <  -:  ----------- object-info: consistently use packet_writer_*()
43:  7f883e9ed6d <  -:  ----------- pkt-line.[ch]: change packet_writer_int to *_INIT macro
44:  c672c99a214 <  -:  ----------- ls-refs: move to "struct packet_writer" API
45:  e901636390d <  -:  ----------- pkt-line.[ch]: invert PACKET_READ_DIE_ON_ERR_PACKET flag
46:  6c4b0cc79f4 <  -:  ----------- protocol: add a packet_client_error() API
47:  9076e26e6b9 <  -:  ----------- protocol v2: correctly send ERR packet in "object-info"
48:  5f33ffb2575 <  -:  ----------- protocol v2: use packet_client_error() in "ls-refs" and "fetch"
49:  b0e125e16af <  -:  ----------- protocol v2: correct & adjust "ls-refs" ERR behavior
50:  8706659cbcf <  -:  ----------- protocol v2: send ERR on unknown in "fetch"
51:  192e2297040 <  -:  ----------- protocol v2: send ERR packet on "not our ref" errors
52:  345c431a074 <  -:  ----------- protocol v2/fetch: send error packet(s) on "filter spec" errors
53:  ca683b62fd6 <  -:  ----------- serve.[ch]: pass a "struct packet_writer" down to commands
54:  c48b0935a81 <  -:  ----------- upload-pack.c: make use of "struct packet_writer"
55:  6dccf2919f4 <  -:  ----------- protocol v2: use helper for "ERR" on bad OID
56:  597d59eb05c <  -:  ----------- protocol v2: use helper for "ERR" on bad OID "list"
57:  caa7f5b3905 <  -:  ----------- protocol v2: use packet_client_error() for "unknown ref"
58:  76dd8a5eee4 <  -:  ----------- protocol v2: use packet_client_error() for "not negotiated"
59:  cdf2bde3db8 <  -:  ----------- protocol v2: use helper for "ERR" on "bad parse"
60:  b6c7bc398d8 <  -:  ----------- protocol v2: emit ERR, don't die()
61:  7269a905300 <  -:  ----------- protocol v2: emit ERR, don't die() in serve.c itself
62:  fbd6b11aea0 <  -:  ----------- ls-remote: set packet_trace_identity(<name>)
63:  e63f219b20a <  -:  ----------- serve: add command to advertise bundle URIs
64:  897baff2c5f <  -:  ----------- test-tool: make "struct test_cmd" generally usable
65:  fdfeb14231b <  -:  ----------- bundle-uri client: add "bundle-uri" parsing + tests
66:  cca82e0c7e5 <  -:  ----------- connect.c: refactor sending of agent & object-format
67:  ee59b3588b7 <  -:  ----------- bundle-uri client: add minimal NOOP client
68:  852b60b5846 <  -:  ----------- bundle-uri client: add "git ls-remote-bundle-uri"
69:  2fdc790875b <  -:  ----------- bundle-uri client: add transfer.injectBundleURI support
70:  7a8eefc549c <  -:  ----------- bundle-uri client: add boolean transfer.bundleURI setting
71:  70865046bea =  1:  dc8591f6d0b bundle API: start writing API documentation
72:  f19af15c9da =  2:  3d7bd9c33be bundle API: change "flags" to be "extra_index_pack_args"
73:  98262f4cb89 !  3:  67197064a8b index-pack: add --progress-title option
    @@ Commit message
     
         Add a --progress-title option to index-pack, when data is piped into
         index-pack its progress is a proxy for whatever's feeding it
    -    data. This option will allow us to set a more relevant progress bar
    -    title.
    +    data.
    +
    +    This option will allow us to set a more relevant progress bar title in
    +    "git bundle unbundle", and is also used in my "bundle-uri" RFC
    +    patches[1] by a new caller in fetch-pack.c.
    +
    +    1. https://lore.kernel.org/git/RFC-cover-00.13-0000000000-20210805T150534Z-avarab@gmail.com/
     
         Signed-off-by: Ævar Arnfjörð Bjarmason <avarab@gmail.com>
     
74:  853d72848a0 =  4:  e4ca8b26962 bundle: show progress on "unbundle"
-- 
2.33.0.662.g438caf9576d

